---
title: "Homework 1"
subtitle: "Research Methods, Spring 2026"
author: "Answer Key"
format:
  pdf:
    output-file: "mccarthy-i-hwk1-1"
    output-ext:  "pdf"
    header-includes:
      - \usepackage{float}
      - \floatplacement{table}{H}
---

```{r}
#| include: false

library(tidyverse)
library(ggplot2)
library(dplyr)
library(lubridate)
library(stringr)
library(readxl)
library(data.table)
library(gdata)
library(scales)
library(kableExtra)
```



My answers to the homework questions are described below. Note that I build the data in a separate script. Any remaining analysis is hidden from the output. Separating the data work from the analysis and output (or sometimes all three) is good practice as it avoids loss of data should things crash. All the necessary code files are available on the GitHub repository [here](https://github.com/imccart/ood-hwk1.git). Instructions for working with the code files are included in the ReadMe file. Enjoy!


```{r}
#| include: false

plan.data <- read_csv("data/output/plan_data.csv")
service.data <- read_csv("data/output/service_area.csv")
plan.type.year1 <- plan.data %>% group_by(plan_type) %>% count() %>% arrange(-n) %>% filter(plan_type!="NA")
plan.type.year2 <- plan.data %>% 
  filter(snp == "No" & eghp == "No" & (planid < 800 | planid >= 900)) %>% 
  group_by(plan_type) %>% count() %>% arrange(-n)

plan.type.enroll <- plan.data %>%
  inner_join(service.data %>% 
               select(contractid, fips, year), 
             by=c("contractid", "fips", "year")) %>%
  filter(snp == "No" & eghp == "No" & (planid < 800 | planid >= 900)) %>% 
  group_by(plan_type) %>% summarize(n=n(), enollment=mean(avg_enrollment, na.rm=TRUE)) %>% arrange(-n)
```

\newpage
# Building the Data
Answer the following based on our initial, simplified dataset of enrollments, plan types, and service areas:

\noindent 1. Provide a table of the count of plans under each plan type.<br>

See @tbl-plans.

```{r} 
#| echo: false
#| label: tbl-plans
#| tbl-cap: All plan types in 2018

options(knitr.kable.NA = 0)
knitr::kable(plan.type.year1, 
             col.names=c("Plan Type","Count"),
             format.args=list(big.mark=","), booktabs = TRUE)
```




\newpage
\noindent 2. Remove all special needs plans (SNP), employer group plans (eghp), and all "800-series" plans. Provide an updated table after making these exclusions.

I remove the relevant plans just by applying filters to the plan data and then creating the table of plan types. Counts of different plan types with these exclusions are presented in @tbl-plans2.

```{r}
#| echo: false
#| label: tbl-plans2
#| tbl-cap: Revised plan types in 2018

options(knitr.kable.NA = 0)
knitr::kable(plan.type.year2, 
             col.names=c("Plan Type","Count"),
             format.args=list(big.mark=","), booktabs = TRUE)
``` 




\newpage
\noindent 3. Provide a table of the average enrollments for each plan type in 2018 after limiting to approved service areas.

To do this, I need to collapse the data to the plan-type level and form the average enrollments across all counties in which that plan type operates. The resulting table is presented in @tbl-enroll.

```{r}
#| echo: false
#| label: tbl-enroll
#| tbl-cap: Enrollments by plan type in 2018

options(knitr.kable.NA = 0)
knitr::kable(plan.type.enroll, digits=0,
             col.names=c("Plan Type","Count","Avg Enrollments"),
             format.args=list(big.mark=","), booktabs = TRUE)
``` 

